2021-01-12 09:09:40,632	WARNING import_thread.py:132 -- The remote function 'maprop.blackbox.dijkstra.solver' has been exported 100 times. It's possible that this warning is accidental, but this may indicate that the same remote function is being defined repeatedly from within many tasks and exported to all of the workers. This can be a performance issue and can be resolved by defining the remote function on the driver instead. See https://github.com/ray-project/ray/issues/6240 for more discussion.
No existing entry for trainer_params.mode.type
{}[type] = <class 'int'>(2)
No existing entry for trainer_params.mode.objective_type
{'type': 2}[objective_type] = <class 'str'>(cost2)
No existing entry for trainer_params.mode.use_marginal
{'type': 2, 'objective_type': 'cost2'}[use_marginal] = <class 'bool'>(True)
No existing entry for trainer_params.mode.nb_samples
{'type': 2, 'objective_type': 'cost2', 'use_marginal': True}[nb_samples] = <class 'int'>(1)
No existing entry for trainer_params.mode.temperature
{'type': 2, 'objective_type': 'cost2', 'use_marginal': True, 'nb_samples': 1}[temperature] = <class 'float'>(0.01)
No existing entry for trainer_params.mode.scale_temperature_by_path_length
{'type': 2, 'objective_type': 'cost2', 'use_marginal': True, 'nb_samples': 1, 'temperature': 0.01}[scale_temperature_by_path_length] = <class 'bool'>(True)
No existing entry for trainer_params.mode.use_gamma
{'type': 2, 'objective_type': 'cost2', 'use_marginal': True, 'nb_samples': 1, 'temperature': 0.01, 'scale_temperature_by_path_length': True}[use_gamma] = <class 'bool'>(True)
No existing entry for trainer_params.mode.loss_type
{'type': 2, 'objective_type': 'cost2', 'use_marginal': True, 'nb_samples': 1, 'temperature': 0.01, 'scale_temperature_by_path_length': True, 'use_gamma': True}[loss_type] = <class 'str'>(mse)
No existing entry for trainer_params.mode.perturb_w
{'type': 2, 'objective_type': 'cost2', 'use_marginal': True, 'nb_samples': 1, 'temperature': 0.01, 'scale_temperature_by_path_length': True, 'use_gamma': True, 'loss_type': 'mse'}[perturb_w] = <class 'bool'>(True)
No existing entry for trainer_params.mode.perturb_w_prime
{'type': 2, 'objective_type': 'cost2', 'use_marginal': True, 'nb_samples': 1, 'temperature': 0.01, 'scale_temperature_by_path_length': True, 'use_gamma': True, 'loss_type': 'mse', 'perturb_w': True}[perturb_w_prime] = <class 'bool'>(True)
No existing entry for trainer_params.mode.type
{}[type] = <class 'int'>(2)
No existing entry for trainer_params.mode.objective_type
{'type': 2}[objective_type] = <class 'str'>(cost2)
No existing entry for trainer_params.mode.use_marginal
{'type': 2, 'objective_type': 'cost2'}[use_marginal] = <class 'bool'>(True)
No existing entry for trainer_params.mode.nb_samples
{'type': 2, 'objective_type': 'cost2', 'use_marginal': True}[nb_samples] = <class 'int'>(1)
No existing entry for trainer_params.mode.temperature
{'type': 2, 'objective_type': 'cost2', 'use_marginal': True, 'nb_samples': 1}[temperature] = <class 'float'>(0.01)
No existing entry for trainer_params.mode.scale_temperature_by_path_length
{'type': 2, 'objective_type': 'cost2', 'use_marginal': True, 'nb_samples': 1, 'temperature': 0.01}[scale_temperature_by_path_length] = <class 'bool'>(True)
No existing entry for trainer_params.mode.use_gamma
{'type': 2, 'objective_type': 'cost2', 'use_marginal': True, 'nb_samples': 1, 'temperature': 0.01, 'scale_temperature_by_path_length': True}[use_gamma] = <class 'bool'>(True)
No existing entry for trainer_params.mode.loss_type
{'type': 2, 'objective_type': 'cost2', 'use_marginal': True, 'nb_samples': 1, 'temperature': 0.01, 'scale_temperature_by_path_length': True, 'use_gamma': True}[loss_type] = <class 'str'>(mse)
No existing entry for trainer_params.mode.perturb_w
{'type': 2, 'objective_type': 'cost2', 'use_marginal': True, 'nb_samples': 1, 'temperature': 0.01, 'scale_temperature_by_path_length': True, 'use_gamma': True, 'loss_type': 'mse'}[perturb_w] = <class 'bool'>(True)
No existing entry for trainer_params.mode.perturb_w_prime
{'type': 2, 'objective_type': 'cost2', 'use_marginal': True, 'nb_samples': 1, 'temperature': 0.01, 'scale_temperature_by_path_length': True, 'use_gamma': True, 'loss_type': 'mse', 'perturb_w': True}[perturb_w_prime] = <class 'bool'>(True)
{
    "evaluate_every": 5,
    "loader_params": {
        "data_dir": "data/warcraft_shortest_path/12x12",
        "evaluate_with_extra": false,
        "normalize": true,
        "use_local_path": false,
        "use_test_set": true
    },
    "model_dir": "results/warcraft_shortest_path_combresnet",
    "num_cpus": 40,
    "num_epochs": 50,
    "problem_type": "warcraft_shortest_path",
    "ray_params": {},
    "save_visualizations": false,
    "seed": 1,
    "trainer_name": "DijkstraMAP",
    "trainer_params": {
        "batch_size": 70,
        "l1_regconst": 0.0,
        "lambda_val": 20.0,
        "lr_milestone_1": 30,
        "lr_milestone_2": 40,
        "mode": {
            "loss_type": "mse",
            "nb_samples": 1,
            "objective_type": "cost2",
            "perturb_w": true,
            "perturb_w_prime": true,
            "scale_temperature_by_path_length": true,
            "temperature": 0.01,
            "type": 2,
            "use_gamma": true,
            "use_marginal": true
        },
        "model_params": {
            "arch_params": {},
            "model_name": "CombResnet18"
        },
        "neighbourhood_fn": "8-grid",
        "optimizer_name": "Adam",
        "optimizer_params": {
            "lr": 0.0005
        },
        "preload_batch": true,
        "use_cuda": true,
        "use_lr_scheduling": true
    },
    "use_ray": true
}
MAP-BACKPROP MODE: {
    "loss_type": "mse",
    "nb_samples": 1,
    "objective_type": "cost2",
    "perturb_w": true,
    "perturb_w_prime": true,
    "scale_temperature_by_path_length": true,
    "temperature": 0.01,
    "type": 2,
    "use_gamma": true,
    "use_marginal": true
}
True
LOSS FUNCTION: mse
OBJECTIVE TYPE: cost2
META: {'input_image_size': 96, 'output_features': 144, 'num_channels': 3, 'denormalize': <maprop.decorators.input_to_numpy object at 0x2b5f74479668>}
EVALUATING
{'loss': 30939.94849609375, 'accuracy': 0.8786736279726028, 'perfect_match_accuracy': 0.032, 'cost_ratio_suggested_true': 2.4898578476905824, 'below_10.0_percent_acc': 0.128, 'below_1.0_percent_acc': 0.055, 'below_0.1_percent_acc': 0.053, 'below_0.01_percent_acc': 0.053, 'below_0.001_percent_acc': 0.038, 'below_0.0001_percent_acc': 0.038, 'valid_acc': 1.0}
Epoch: 1	Batch time (1.792669)	Data time (0.006187)	Cuda time (0.000002)	Loss (2640.019899)	Accuracy (0.891251)
Epoch: 2	Batch time (1.784328)	Data time (0.006280)	Cuda time (0.000002)	Loss (538.738980)	Accuracy (0.901835)
Epoch: 3	Batch time (1.774493)	Data time (0.006284)	Cuda time (0.000002)	Loss (394.376546)	Accuracy (0.902797)
Epoch: 4	Batch time (1.776234)	Data time (0.006299)	Cuda time (0.000002)	Loss (288.688617)	Accuracy (0.904590)
Epoch: 5	Batch time (1.775587)	Data time (0.006329)	Cuda time (0.000002)	Loss (214.762766)	Accuracy (0.907506)
EVALUATING
{'loss': 260.68757919311525, 'accuracy': 0.9099791800975799, 'perfect_match_accuracy': 0.026, 'cost_ratio_suggested_true': 1.1899144434928894, 'below_10.0_percent_acc': 0.924, 'below_1.0_percent_acc': 0.256, 'below_0.1_percent_acc': 0.224, 'below_0.01_percent_acc': 0.224, 'below_0.001_percent_acc': 0.219, 'below_0.0001_percent_acc': 0.219, 'valid_acc': 1.0}
Epoch: 6	Batch time (1.780674)	Data time (0.006239)	Cuda time (0.000002)	Loss (217.688448)	Accuracy (0.909141)
Epoch: 7	Batch time (1.767413)	Data time (0.006311)	Cuda time (0.000002)	Loss (194.954385)	Accuracy (0.911222)
Epoch: 8	Batch time (1.766930)	Data time (0.006354)	Cuda time (0.000002)	Loss (166.116218)	Accuracy (0.913498)
Epoch: 9	Batch time (1.810615)	Data time (0.006460)	Cuda time (0.000002)	Loss (126.557703)	Accuracy (0.915192)
Epoch: 10	Batch time (1.770252)	Data time (0.006355)	Cuda time (0.000002)	Loss (115.997871)	Accuracy (0.917376)
EVALUATING
{'loss': 85.2426533126831, 'accuracy': 0.917138894200325, 'perfect_match_accuracy': 0.035, 'cost_ratio_suggested_true': 1.167921962738037, 'below_10.0_percent_acc': 0.959, 'below_1.0_percent_acc': 0.325, 'below_0.1_percent_acc': 0.283, 'below_0.01_percent_acc': 0.283, 'below_0.001_percent_acc': 0.277, 'below_0.0001_percent_acc': 0.277, 'valid_acc': 1.0}
Epoch: 11	Batch time (1.770701)	Data time (0.006349)	Cuda time (0.000002)	Loss (96.088304)	Accuracy (0.917763)
Epoch: 12	Batch time (1.771222)	Data time (0.006328)	Cuda time (0.000002)	Loss (86.283318)	Accuracy (0.919128)
Epoch: 13	Batch time (1.774533)	Data time (0.006327)	Cuda time (0.000002)	Loss (93.188773)	Accuracy (0.921788)
Epoch: 14	Batch time (1.781901)	Data time (0.006255)	Cuda time (0.000002)	Loss (90.889880)	Accuracy (0.923590)
Epoch: 15	Batch time (1.765550)	Data time (0.006342)	Cuda time (0.000002)	Loss (78.711845)	Accuracy (0.923194)
EVALUATING
{'loss': 58.0814693069458, 'accuracy': 0.9255763971805573, 'perfect_match_accuracy': 0.05, 'cost_ratio_suggested_true': 1.1301280641555786, 'below_10.0_percent_acc': 0.987, 'below_1.0_percent_acc': 0.424, 'below_0.1_percent_acc': 0.384, 'below_0.01_percent_acc': 0.384, 'below_0.001_percent_acc': 0.376, 'below_0.0001_percent_acc': 0.376, 'valid_acc': 1.0}
Epoch: 16	Batch time (1.767269)	Data time (0.006271)	Cuda time (0.000002)	Loss (62.514235)	Accuracy (0.925681)
Epoch: 17	Batch time (1.772896)	Data time (0.006278)	Cuda time (0.000002)	Loss (66.243976)	Accuracy (0.926067)
Epoch: 18	Batch time (1.763534)	Data time (0.006320)	Cuda time (0.000002)	Loss (67.930156)	Accuracy (0.925530)
Epoch: 19	Batch time (1.776062)	Data time (0.007460)	Cuda time (0.000002)	Loss (68.573771)	Accuracy (0.926491)
Epoch: 20	Batch time (1.778505)	Data time (0.006293)	Cuda time (0.000002)	Loss (57.968493)	Accuracy (0.926982)
EVALUATING
{'loss': 45.65436729431153, 'accuracy': 0.9274166864156723, 'perfect_match_accuracy': 0.05, 'cost_ratio_suggested_true': 1.165522598028183, 'below_10.0_percent_acc': 0.991, 'below_1.0_percent_acc': 0.483, 'below_0.1_percent_acc': 0.44, 'below_0.01_percent_acc': 0.44, 'below_0.001_percent_acc': 0.426, 'below_0.0001_percent_acc': 0.426, 'valid_acc': 1.0}
Epoch: 21	Batch time (1.781839)	Data time (0.006311)	Cuda time (0.000002)	Loss (47.001448)	Accuracy (0.928988)
Epoch: 22	Batch time (1.776875)	Data time (0.006319)	Cuda time (0.000002)	Loss (46.365731)	Accuracy (0.929112)
Epoch: 23	Batch time (1.779151)	Data time (0.006312)	Cuda time (0.000002)	Loss (56.632824)	Accuracy (0.929603)
Epoch: 24	Batch time (1.784224)	Data time (0.006280)	Cuda time (0.000002)	Loss (48.822545)	Accuracy (0.931458)
Epoch: 25	Batch time (1.778149)	Data time (0.006307)	Cuda time (0.000002)	Loss (40.311142)	Accuracy (0.932640)
EVALUATING
{'loss': 43.13168561935425, 'accuracy': 0.9349583464860917, 'perfect_match_accuracy': 0.067, 'cost_ratio_suggested_true': 1.1322368574142456, 'below_10.0_percent_acc': 0.998, 'below_1.0_percent_acc': 0.638, 'below_0.1_percent_acc': 0.604, 'below_0.01_percent_acc': 0.604, 'below_0.001_percent_acc': 0.588, 'below_0.0001_percent_acc': 0.588, 'valid_acc': 1.0}
Epoch: 26	Batch time (1.780875)	Data time (0.006239)	Cuda time (0.000002)	Loss (35.605183)	Accuracy (0.933994)
Epoch: 27	Batch time (1.770464)	Data time (0.006524)	Cuda time (0.000002)	Loss (40.072672)	Accuracy (0.934463)
Epoch: 28	Batch time (1.785806)	Data time (0.006281)	Cuda time (0.000002)	Loss (33.535395)	Accuracy (0.934721)
Epoch: 29	Batch time (1.768988)	Data time (0.006411)	Cuda time (0.000002)	Loss (35.821916)	Accuracy (0.935939)
Epoch: 30	Batch time (1.780333)	Data time (0.006392)	Cuda time (0.000002)	Loss (30.780864)	Accuracy (0.935619)
EVALUATING
{'loss': 37.62344123840332, 'accuracy': 0.9353958529233932, 'perfect_match_accuracy': 0.082, 'cost_ratio_suggested_true': 1.1587867999076844, 'below_10.0_percent_acc': 0.998, 'below_1.0_percent_acc': 0.666, 'below_0.1_percent_acc': 0.634, 'below_0.01_percent_acc': 0.634, 'below_0.001_percent_acc': 0.611, 'below_0.0001_percent_acc': 0.611, 'valid_acc': 1.0}
Epoch: 31	Batch time (1.786579)	Data time (0.006498)	Cuda time (0.000002)	Loss (19.779182)	Accuracy (0.936357)
Epoch: 32	Batch time (1.773659)	Data time (0.006467)	Cuda time (0.000002)	Loss (17.078732)	Accuracy (0.936808)
Epoch: 33	Batch time (1.780783)	Data time (0.006408)	Cuda time (0.000002)	Loss (17.048712)	Accuracy (0.937278)
Epoch: 34	Batch time (1.778851)	Data time (0.006426)	Cuda time (0.000002)	Loss (16.140636)	Accuracy (0.937359)
Epoch: 35	Batch time (1.775886)	Data time (0.006287)	Cuda time (0.000002)	Loss (16.897945)	Accuracy (0.937924)
EVALUATING
{'loss': 22.673010425567625, 'accuracy': 0.9373333477973937, 'perfect_match_accuracy': 0.079, 'cost_ratio_suggested_true': 1.1299677789211273, 'below_10.0_percent_acc': 0.999, 'below_1.0_percent_acc': 0.723, 'below_0.1_percent_acc': 0.691, 'below_0.01_percent_acc': 0.691, 'below_0.001_percent_acc': 0.672, 'below_0.0001_percent_acc': 0.672, 'valid_acc': 1.0}
Epoch: 36	Batch time (1.772049)	Data time (0.006348)	Cuda time (0.000002)	Loss (15.940351)	Accuracy (0.937503)
Epoch: 37	Batch time (1.773027)	Data time (0.006262)	Cuda time (0.000002)	Loss (15.706093)	Accuracy (0.938127)
Epoch: 38	Batch time (1.773466)	Data time (0.006334)	Cuda time (0.000003)	Loss (15.574605)	Accuracy (0.937546)
Epoch: 39	Batch time (1.781020)	Data time (0.006492)	Cuda time (0.000002)	Loss (15.562091)	Accuracy (0.938057)
Epoch: 40	Batch time (1.792632)	Data time (0.006479)	Cuda time (0.000002)	Loss (15.417444)	Accuracy (0.937930)
EVALUATING
{'loss': 25.56939330101013, 'accuracy': 0.9387222397327423, 'perfect_match_accuracy': 0.082, 'cost_ratio_suggested_true': 1.1261525177955627, 'below_10.0_percent_acc': 0.999, 'below_1.0_percent_acc': 0.749, 'below_0.1_percent_acc': 0.717, 'below_0.01_percent_acc': 0.717, 'below_0.001_percent_acc': 0.698, 'below_0.0001_percent_acc': 0.698, 'valid_acc': 1.0}
Epoch: 41	Batch time (1.789112)	Data time (0.006657)	Cuda time (0.000002)	Loss (13.884795)	Accuracy (0.938405)
Epoch: 42	Batch time (1.779898)	Data time (0.006431)	Cuda time (0.000002)	Loss (14.323512)	Accuracy (0.938138)
Epoch: 43	Batch time (1.780121)	Data time (0.006355)	Cuda time (0.000002)	Loss (14.799284)	Accuracy (0.938381)
Epoch: 44	Batch time (1.787278)	Data time (0.006531)	Cuda time (0.000002)	Loss (14.413129)	Accuracy (0.938419)
Epoch: 45	Batch time (1.773723)	Data time (0.006470)	Cuda time (0.000002)	Loss (14.410023)	Accuracy (0.938338)
EVALUATING
{'loss': 23.864119424819947, 'accuracy': 0.9385000097751618, 'perfect_match_accuracy': 0.084, 'cost_ratio_suggested_true': 1.1192407941818237, 'below_10.0_percent_acc': 0.999, 'below_1.0_percent_acc': 0.752, 'below_0.1_percent_acc': 0.72, 'below_0.01_percent_acc': 0.72, 'below_0.001_percent_acc': 0.701, 'below_0.0001_percent_acc': 0.701, 'valid_acc': 1.0}
Epoch: 46	Batch time (1.753656)	Data time (0.006342)	Cuda time (0.000002)	Loss (14.140499)	Accuracy (0.938188)
Epoch: 47	Batch time (1.766367)	Data time (0.006313)	Cuda time (0.000002)	Loss (13.762237)	Accuracy (0.938326)
Epoch: 48	Batch time (1.765313)	Data time (0.006386)	Cuda time (0.000002)	Loss (13.504208)	Accuracy (0.938257)
Epoch: 49	Batch time (1.761514)	Data time (0.006272)	Cuda time (0.000002)	Loss (13.213239)	Accuracy (0.938538)
Epoch: 50	Batch time (1.776171)	Data time (0.006322)	Cuda time (0.000002)	Loss (13.859924)	Accuracy (0.938433)
EVALUATING
{'loss': 22.34267098426819, 'accuracy': 0.9383750212192535, 'perfect_match_accuracy': 0.084, 'cost_ratio_suggested_true': 1.1235246932506562, 'below_10.0_percent_acc': 0.999, 'below_1.0_percent_acc': 0.742, 'below_0.1_percent_acc': 0.711, 'below_0.01_percent_acc': 0.711, 'below_0.001_percent_acc': 0.692, 'below_0.0001_percent_acc': 0.692, 'valid_acc': 1.0}
